
window.YSCONF = {
/*    url:{ 
        com_login:{url:'',method:'post'}, 
        com_pro:{url:'/php/index.php/Yswechat/Weindex/pro_single_list',method:'post_data_watch'},
        work_image:{url:'/php/index.php/Yswechat/Weindex/program_work_sinimage',method:'post_data_watch'},
        work_matcount:{url:'/php/index.php/Yswechat/Weindex/program_work_matcount',method:'post_data_watch'},
        plan_mat:{url:'/php/index.php/Yswechat/Weindex/yuancai_list',method:'post_data_watch'},
        plan_songjian:{url:'/php/index.php/Yswechat/Weindex/songjian_list',method:'post_data_watch'},
        com_em:{url:'/php/index.php/Yswechat/Weindex/com_em',method:'post_data_watch'},
        com_ed:{url:'/php/index.php/Yswechat/Weindex/com_ed',method:'post_data_watch'},
        com_ea:{url:'/php/index.php/Yswechat/Weindex/com_ea',method:'post_data_watch'},
        user_info:{url:'/php/index.php/Yswechat/Weindex/getuserinfo',method:'post_data_watch'},
        my_info:{url:'/php/index.php/Yswechat/Weindex/getuserinfo',method:'post_data_watch'},
        gether_data:{url:'/php/index.php/Yswechat/Weindex/program_gether',method:'post_data_watch'}, 
        gether_save:{url:'/php/index.php/Yswechat/Weindex/program_gether_save',method:'post_data_watch'},
        jiben:{url:'/php/index.php/Yswechat/Weindex/pro_base',method:'post_data_watch'},
        jishu_info:{url:'/php/index.php/Yswechat/Weindex/program_tecnology_info',method:'post_data_watch'},
        shigong_unit:{url:'/php/index.php/Yswechat/Weindex/pro_shigong',method:'post_data_watch'},
        jianli_unit:{url:'/php/index.php/Yswechat/Weindex/pro_jianli',method:'post_data_watch'},

        jianshe_unit:{url:'/php/index.php/Yswechat/Weindex/pro_jianshe',method:'post_data_watch'},
        yc_info:{url:'/php/index.php/Yswechat/Weindex/com_esyc',method:'post_data_watch'},

        by_info:{url:'/php/index.php/Yswechat/Weindex/com_essj',method:'post_data_watch'},
        // ty_info:{url:'/php/index.php/Yswechat/Weindex/com_esyc',method:'post_data_watch'},
        // ks_info:{url:'/php/index.php/Yswechat/Weindex/com_esyc',method:'post_data_watch'},
        // zt_info:{url:'/php/index.php/Yswechat/Weindex/com_esyc',method:'post_data_watch'},
        // hj_info:{url:'/php/index.php/Yswechat/Weindex/com_esyc',method:'post_data_watch'},
       sheji_unit:{url:'/php/index.php/Yswechat/Weindex/pro_sheji',method:'post_data_watch'},

        kancha:{url:'/php/index.php/Yswechat/Weindex/pro_kancha',method:'post_data_watch'},
        othera_unit:{url:'/php/index.php/Yswechat/Weindex/pro_other',method:'post_data_watch'},

        unbindwe:{url:'/php/index.php/Yswechat/Weindex/unbind',method:'post_data_watch'},
        pwd_edit:{url:'/php/index.php/Yswechat/Weindex/password',method:'post_data_watch'},
        get_code:{url:'/php/index.php/Yswechat/Login/getphoneCode',method:'post_data_watch'},
        tel_edit:{url:'/php/index.php/Yswechat/Weindex/tel',method:'post_data_watch'},
        my_edit:{url:'/php/index.php/Yswechat/Weindex/edituserinfo',method:'post_data_watch'},

        sin_add:{url:'/php/index.php/Yswechat/Weindex/sin_add',method:'post_data_watch'},
        pro_add:{url:'/php/index.php/Yswechat/Weindex/pro_add',method:'post_data_watch'},
        com_province:{url:'/php/index.php/Ysback/Open/provwe',method:'post_data_watch'},
        com_city:{url:'/php/index.php/Ysback/Open/citywe',method:'post_data_watch'},
        pro_del:{url:'/php/index.php/Yswechat/Weindex/pro_del',method:'post_data_watch'},
        sin_del:{url:'/php/index.php/Yswechat/Weindex/sin_del',method:'post_data_watch'},
        wendu_info:{url:'/php/index.php/Yswechat/Weindex/wendu',method:'post_data_watch'},

       


    },    
    win:{
        warmtips_teacher_set:{template:'warmtips_teacher_set',type:'add',title:'温馨提示',temdata:{}}, 
 },*/


    url:{ 
        com_login:{url:'',method:'post'}, 
        com_pro:{url:'/api/wechat/Weindex/pro_single_list',method:'post_data_watch'},
        work_image:{url:'/api/wechat/Weindex/program_work_sinimage',method:'post_data_watch'},
        work_matcount:{url:'/api/wechat/Weindex/program_work_matcount',method:'post_data_watch'},
        plan_mat:{url:'/api/wechat/Weindex/yuancai_list',method:'post_data_watch'},
        plan_songjian:{url:'/api/wechat/Weindex/songjian_list',method:'post_data_watch'},
        com_em:{url:'/api/wechat/Weindex/com_em',method:'post_data_watch'},
        com_ed:{url:'/api/wechat/Weindex/com_ed',method:'post_data_watch'},
        com_ea:{url:'/api/wechat/Weindex/com_ea',method:'post_data_watch'},
        user_info:{url:'/api/wechat/Weindex/getuserinfo',method:'post_data_watch'},
        my_info:{url:'/api/wechat/Weindex/getuserinfo',method:'post_data_watch'},
        gether_data:{url:'/api/wechat/Weindex/program_gether',method:'post_data_watch'}, 
        gether_save:{url:'/api/wechat/Weindex/program_gether_save',method:'post_data_watch'},
        jiben:{url:'/api/wechat/Weindex/pro_base',method:'post_data_watch'},
        jishu_info:{url:'/api/wechat/Weindex/program_tecnology_info',method:'post_data_watch'},
        shigong_unit:{url:'/api/wechat/Weindex/pro_shigong',method:'post_data_watch'},
        jianli_unit:{url:'/api/wechat/Weindex/pro_jianli',method:'post_data_watch'},

        jianshe_unit:{url:'/api/wechat/Weindex/pro_jianshe',method:'post_data_watch'},
        yc_info:{url:'/api/wechat/Weindex/com_esyc',method:'post_data_watch'},

        by_info:{url:'/api/wechat/Weindex/com_essj',method:'post_data_watch'},
        // ty_info:{url:'/api/wechat/Weindex/com_esyc',method:'post_data_watch'},
        // ks_info:{url:'/api/wechat/Weindex/com_esyc',method:'post_data_watch'},
        // zt_info:{url:'/api/wechat/Weindex/com_esyc',method:'post_data_watch'},
        // hj_info:{url:'/api/wechat/Weindex/com_esyc',method:'post_data_watch'},
       sheji_unit:{url:'/api/wechat/Weindex/pro_sheji',method:'post_data_watch'},

        kancha:{url:'/api/wechat/Weindex/pro_kancha',method:'post_data_watch'},
        othera_unit:{url:'/api/wechat/Weindex/pro_other',method:'post_data_watch'},

        unbindwe:{url:'/api/wechat/Weindex/unbind',method:'post_data_watch'},
        pwd_edit:{url:'/api/wechat/Weindex/password',method:'post_data_watch'},

        get_code:{url:'/api/wechat/Login/getphoneCode2',method:'post_data_watch'},
        
        tel_edit:{url:'/api/wechat/Weindex/tel',method:'post_data_watch'},
        my_edit:{url:'/api/wechat/Weindex/edituserinfo',method:'post_data_watch'},

        sin_add:{url:'/api/wechat/Weindex/sin_add',method:'post_data_watch'},
        pro_add:{url:'/api/wechat/Weindex/pro_add',method:'post_data_watch'},
        com_province:{url:'/api/ver1/Open/provwe',method:'post_data_watch'},
        com_city:{url:'/api/ver1/Open/citywe',method:'post_data_watch'},
        pro_del:{url:'/api/wechat/Weindex/pro_del',method:'post_data_watch'},
        sin_del:{url:'/api/wechat/Weindex/sin_del',method:'post_data_watch'},
        wendu_info:{url:'/api/wechat/Weindex/wendu',method:'post_data_watch'},

       


    },    
    win:{
        warmtips_teacher_set:{template:'warmtips_teacher_set',type:'add',title:'温馨提示',temdata:{}}, 
 },



 ext:{
        jichu:['桩芯','承台垫层','承台','基础梁垫层','基础梁','电梯基坑垫层','电梯基坑'],
        zhuti:['首','二','三','四','五','六','七','八','九','十','十一','十二','十三','十四','十五','十六','十七','十八','十九','二十','二十一','二十二','二十三','二十四','二十五','二十六','二十七','二十八','二十九','三十','三十一','三十二','三十三','三十四','三十五','三十六','三十七','三十八','三十九','四十','五十一','五十二','五十三','五十四','五十五','五十六','五十七','五十八','五十九','五十'],
        yctypelist:[     
      {'title':'钢筋',t:'1'},
      {'title':'水泥',t:'2'},
      {'title':'砂',t:'3'},
      {'title':'砖',t:'4'},
      {'title':'装饰',t:'5'},
      {'title':'节能',t:'6'},
      {'title':'防水',t:'7'},
      {'title':'水电',t:'8'},
      {'title':'安全',t:'9'},
       {'title':'全部',t:'0'} 
      ],
      ftypelist:[     
      {'title':'基础',t:'3'},
      {'title':'主体',t:'4'},
      {'title':'装修',t:'5'},
      {'title':'幕墙',t:'6'},
      {'title':'屋面',t:'7'},
      {'title':'节能',t:'8'},
      {'title':'给排水',t:'9'},
      {'title':'电气',t:'10'}, 
      ],
 }  
};



        //过滤
function gl(d){
 return  d.value?d.value:''; 
}


var TouchSlide=function(a){a=a||{};var b={slideCell:a.slideCell||"#touchSlide",titCell:a.titCell||".hd li",mainCell:a.mainCell||".bd",effect:a.effect||"left",autoPlay:a.autoPlay||!1,delayTime:a.delayTime||200,interTime:a.interTime||2500,defaultIndex:a.defaultIndex||0,titOnClassName:a.titOnClassName||"on",autoPage:a.autoPage||!1,prevCell:a.prevCell||".prev",nextCell:a.nextCell||".next",pageStateCell:a.pageStateCell||".pageState",pnLoop:"undefined "==a.pnLoop?!0:a.pnLoop,startFun:a.startFun||null,endFun:a.endFun||null,switchLoad:a.switchLoad||null},c=document.getElementById(b.slideCell.replace("#",""));if(!c)return!1;var d=function(a,b){a=a.split(" ");var c=[];b=b||document;var d=[b];for(var e in a)0!=a[e].length&&c.push(a[e]);for(var e in c){if(0==d.length)return!1;var f=[];for(var g in d)if("#"==c[e][0])f.push(document.getElementById(c[e].replace("#","")));else if("."==c[e][0])for(var h=d[g].getElementsByTagName("*"),i=0;i<h.length;i++){var j=h[i].className;j&&-1!=j.search(new RegExp("\\b"+c[e].replace(".","")+"\\b"))&&f.push(h[i])}else for(var h=d[g].getElementsByTagName(c[e]),i=0;i<h.length;i++)f.push(h[i]);d=f}return 0==d.length||d[0]==b?!1:d},e=function(a,b){var c=document.createElement("div");c.innerHTML=b,c=c.children[0];var d=a.cloneNode(!0);return c.appendChild(d),a.parentNode.replaceChild(c,a),m=d,c},g=function(a,b){!a||!b||a.className&&-1!=a.className.search(new RegExp("\\b"+b+"\\b"))||(a.className+=(a.className?" ":"")+b)},h=function(a,b){!a||!b||a.className&&-1==a.className.search(new RegExp("\\b"+b+"\\b"))||(a.className=a.className.replace(new RegExp("\\s*\\b"+b+"\\b","g"),""))},i=b.effect,j=d(b.prevCell,c)[0],k=d(b.nextCell,c)[0],l=d(b.pageStateCell)[0],m=d(b.mainCell,c)[0];if(!m)return!1;var N,O,n=m.children.length,o=d(b.titCell,c),p=o?o.length:n,q=b.switchLoad,r=parseInt(b.defaultIndex),s=parseInt(b.delayTime),t=parseInt(b.interTime),u="false"==b.autoPlay||0==b.autoPlay?!1:!0,v="false"==b.autoPage||0==b.autoPage?!1:!0,w="false"==b.pnLoop||0==b.pnLoop?!1:!0,x=r,y=null,z=null,A=null,B=0,C=0,D=0,E=0,G=/hp-tablet/gi.test(navigator.appVersion),H="ontouchstart"in window&&!G,I=H?"touchstart":"mousedown",J=H?"touchmove":"",K=H?"touchend":"mouseup",M=m.parentNode.clientWidth,P=n;if(0==p&&(p=n),v){p=n,o=o[0],o.innerHTML="";var Q="";if(1==b.autoPage||"true"==b.autoPage)for(var R=0;p>R;R++)Q+="<li>"+(R+1)+"</li>";else for(var R=0;p>R;R++)Q+=b.autoPage.replace("$",R+1);o.innerHTML=Q,o=o.children}"leftLoop"==i&&(P+=2,m.appendChild(m.children[0].cloneNode(!0)),m.insertBefore(m.children[n-1].cloneNode(!0),m.children[0])),N=e(m,'<div class="tempWrap" style="overflow:hidden; position:relative;"></div>'),m.style.cssText="width:"+P*M+"px;"+"position:relative;overflow:hidden;padding:0;margin:0;";for(var R=0;P>R;R++)m.children[R].style.cssText="display:table-cell;vertical-align:top;width:"+M+"px";var S=function(){"function"==typeof b.startFun&&b.startFun(r,p)},T=function(){"function"==typeof b.endFun&&b.endFun(r,p)},U=function(a){var b=("leftLoop"==i?r+1:r)+a,c=function(a){for(var b=m.children[a].getElementsByTagName("img"),c=0;c<b.length;c++)b[c].getAttribute(q)&&(b[c].setAttribute("src",b[c].getAttribute(q)),b[c].removeAttribute(q))};if(c(b),"leftLoop"==i)switch(b){case 0:c(n);break;case 1:c(n+1);break;case n:c(0);break;case n+1:c(1)}},V=function(){M=N.clientWidth,m.style.width=P*M+"px";for(var a=0;P>a;a++)m.children[a].style.width=M+"px";var b="leftLoop"==i?r+1:r;W(-b*M,0)};window.addEventListener("resize",V,!1);var W=function(a,b,c){c=c?c.style:m.style,c.webkitTransitionDuration=c.MozTransitionDuration=c.msTransitionDuration=c.OTransitionDuration=c.transitionDuration=b+"ms",c.webkitTransform="translate("+a+"px,0)"+"translateZ(0)",c.msTransform=c.MozTransform=c.OTransform="translateX("+a+"px)"},X=function(a){switch(i){case"left":r>=p?r=a?r-1:0:0>r&&(r=a?0:p-1),null!=q&&U(0),W(-r*M,s),x=r;break;case"leftLoop":null!=q&&U(0),W(-(r+1)*M,s),-1==r?(z=setTimeout(function(){W(-p*M,0)},s),r=p-1):r==p&&(z=setTimeout(function(){W(-M,0)},s),r=0),x=r}S(),A=setTimeout(function(){T()},s);for(var c=0;p>c;c++)h(o[c],b.titOnClassName),c==r&&g(o[c],b.titOnClassName);0==w&&(h(k,"nextStop"),h(j,"prevStop"),0==r?g(j,"prevStop"):r==p-1&&g(k,"nextStop")),l&&(l.innerHTML="<span>"+(r+1)+"</span>/"+p)};if(X(),u&&(y=setInterval(function(){r++,X()},t)),o)for(var R=0;p>R;R++)!function(){var a=R;o[a].addEventListener("click",function(){clearTimeout(z),clearTimeout(A),r=a,X()})}();k&&k.addEventListener("click",function(){(1==w||r!=p-1)&&(clearTimeout(z),clearTimeout(A),r++,X())}),j&&j.addEventListener("click",function(){(1==w||0!=r)&&(clearTimeout(z),clearTimeout(A),r--,X())});var Y=function(a){clearTimeout(z),clearTimeout(A),O=void 0,D=0;var b=H?a.touches[0]:a;B=b.pageX,C=b.pageY,m.addEventListener(J,Z,!1),m.addEventListener(K,$,!1)},Z=function(a){if(!H||!(a.touches.length>1||a.scale&&1!==a.scale)){var b=H?a.touches[0]:a;if(D=b.pageX-B,E=b.pageY-C,"undefined"==typeof O&&(O=!!(O||Math.abs(D)<Math.abs(E))),!O){switch(a.preventDefault(),u&&clearInterval(y),i){case"left":(0==r&&D>0||r>=p-1&&0>D)&&(D=.4*D),W(-r*M+D,0);break;case"leftLoop":W(-(r+1)*M+D,0)}null!=q&&Math.abs(D)>M/3&&U(D>-0?-1:1)}}},$=function(a){0!=D&&(a.preventDefault(),O||(Math.abs(D)>M/10&&(D>0?r--:r++),X(!0),u&&(y=setInterval(function(){r++,X()},t))),m.removeEventListener(J,Z,!1),m.removeEventListener(K,$,!1))};m.addEventListener(I,Y,!1)};


window.fac = {
  changeClass:function(classname){ 
    window.event.stopPropagation();
    this[classname] = !this[classname]; 
  },
  binditem:function() {
              $(document).on('click','.js_item', function(){
            var id = $(this).data('id');
            window.pageManager.go(id);
                });

            $(document).on('click','.js_back', function(){
                var id = $(this).data('id');
                window.pageManager.back(id);
            });
  },
  changeopen:function(dv,key) { 
         $a = $(dv).find('.weui-mask');
         if(key=='all'){
            this.prosta = false;
            this.sinsta = false;
            $a.fadeOut(300);
         }else{
            var nakey = key=='prosta'?'sinsta':'prosta';
            this[nakey] = false;

          this[key] = !this[key];
          var t = this[key]?$a.fadeIn(300):$a.fadeOut(300); 
         }
          
        }, 
  setcode:function(mvu) {
        //对返回的工程，子单位进行存储处理；prcodeid,scodeid ,prname,sname;
     var obj = {prcodeid:'',scodeid:'',prname:'',sname:'',proindex:0,sinindex:0};
    if(mvu.com_pro.data.datalist.length>0){
        var pro = mvu.com_pro.data.datalist[0];
        obj.prcodeid = pro.codeid;
        obj.prname = pro.prname;
        if(pro.sinchl.datalist.length>0){
            var sin = pro.sinchl.datalist[0];
            obj.scodeid = sin.codeid;
            obj.sname = sin.sname; 
        }
    } 
    fac.setstore('sitedata',obj);  
        },
afterloaddo:function(mainvue,clb) {  
    if(mainvue.com_pro.status==1){
        //送检计划 ， 选原材后 sname  二次进入时取第一工程数据
      if (fac.getsname=='原材') {fac.setcode(mainvue);}      
     clb(mainvue);
     fac.binditem();
}else{
    fac.load(1);
    mainvue.com_pro.done = function(mvu){
    fac.setcode(mvu);
    // mainvue.sitedata = obj;

      clb(mvu);
      fac.load(0);
      fac.binditem();
      if(mvu.com_pro.data.datalist.length>0){}else{
        fac.showlip('请先创建工程及子单位！',3000); 
      }
      
    };
mainvue.com_pro.watch.time = fac.time();
} 



},
setcodeid:function(codeid,k) {
           fac.setstore('wecodeid',codeid);
           fac.setstore('stype',k);
        },
  showlip:function(str,time) { 
        var ht = time?time:2000;
       if($('#lip').css('display') != 'none'){return;}  
       $('#lip').find('.con').html(str);
       $('#lip').fadeIn(200);
       setTimeout(function() {
          $('#lip').fadeOut(200);
       },ht);
      
  },
  load:function(num){
    if(num){
       if($('.weui-loadmore').css('display') != 'none'){return;} 
   }
   var t = num?$('.weui-loadmore').fadeIn(200):$('.weui-loadmore').fadeOut(200);
  },
  bigload:function(num,s) {
    var str =s?s:'数据加载中';
    $('#loadingToast').find('p').html(str);
     if(num){
       if($('#loadingToast').css('display') != 'none'){return;} 
   }
   var t = num?$('#loadingToast').fadeIn(100):$('#loadingToast').fadeOut(100); 

   setTimeout(function() {
     $('#loadingToast').fadeOut(100);
   },10000);
  },
  bigdone:function(n) {
     
  },
  before:function(mv,key) {
       fac.bigload(1);
       var sitedata = fac.getstore('sitedata');
       mv[key].params = {codeid:sitedata.prcodeid};
  },
 
  done:function(mv) { 
      setTimeout(function() { fac.bigload(0);},600);
  },
  getprname:function() {
     return fac.getstore('sitedata')['prname']; 
  },
  getsname:function() {
      return fac.getstore('sitedata')['sname'];  
  },
  yschk:function(value,key) { 
      var data = {codeid:value.codeid};
      data[key] = value[key]==0?1:0;
      var url = YSCONF.url.com_em.url;
       // debugger;
      fac.post(url,data,function(re){
        if(re.code==1){
            value[key] = data[key];
            $.toptip('保存成功', 'success');
        }else{
            $.toptip('更新失败', 'error');
        }
      });
  },
  dore:function(re,str) {
      if(re.code==1){
        $.toptip('保存成功', 'success');
        setTimeout(function() { 
          window.pageManager.back(str);
        },1000);
      }else{
        $.toptip(re.msg+',保存失败', 'error');
      }
  },
  coverobj:function(o,n,override){
        //合并两个对象；override 是新对象n 是否覆盖老对象o；
       for(var p in n)if(n.hasOwnProperty(p) && (!o.hasOwnProperty(p) || override))o[p]=n[p];
        return o;
    },
      dozushu:function(zs) {
        var arr = [];
        for(i=0;i<zs;i++){
          arr.push({val:''});
        }              
        return arr;
      },
      spl:function(str,k) {
        if(!str)return '';
        var el = str.split(',');
        var re = el[k]?el[k]:'';
         return re;
      },
seturl:function(part){
  //   var name = YSCONF.url[part].name||'';
  // console.log({scope:sco,name:name});
//路径
var path = YSCONF.url[part].url;
//var len = path.split('/').length;
//接口层级，如  a/b 就是root2； a/b/c 就是root3;
//var rooturl = 'root'+len;
//真实路径
//var url = window[rooturl] + path;
var url = path;

//测试路径
// if(location.href.split('.')[0]=='http://ys'||location.href.split('.')[0]=='http://192'){
//   len = part.split('_').length;
//   rooturl = 'root'+len;
//   url =window[rooturl] + part.split('_').join('/');
// } 
  var p = {
      url:url,
      method:YSCONF.url[part].method 
      };
  return p;
},
   loginpost:function(da,url,fun){      
       var re;    
       $.ajax({
        url:url,
        async:false,
        type:'POST',
        data:da,
        dataType:'json',
        success:function(re){if(typeof(fun)==="function"){fun(re);}},
        error:function(re){ if(typeof(fun)==="function"){fun(re);}}
       }); 
    },
     post:function(url,da,fun){      
       var re;    
       $.ajax({
        url:url,
        async:false,
        type:'POST',
        data:da,
        dataType:'json',
        success:function(re){if(typeof(fun)==="function"){
           if(re.code===-1){ 
                 // $.toast("登陆超时", "forbidden");
                 
                 setTimeout(function(){
                  window.location.href = "/wap/login.html";
                 },1000);
              }else{
               fun(re);
              }
          }},
        error:function(re){ if(typeof(fun)==="function"){fun(re);}}
       }); 
    },
     get:function(url,da,fun){      
       var re;    
       $.ajax({
        url:url,
        async:false,
        type:'GET',
        data:da,
        dataType:'json',
        success:function(re){if(typeof(fun)==="function"){
           if(re.code===-1){ 
                 // $.toast("登陆超时", "forbidden");
                 setTimeout(function(){
                  window.location.href = "/wap/login.html";
                 },1000);
              }else{
               fun(re);
              }
          }},
        error:function(re){ if(typeof(fun)==="function"){fun(re);}}
       }); 
    },
setCookie:function(name,value){
         //写cookies 
        var Days = 30; 
        var exp = new Date(); 
        exp.setTime(exp.getTime() + Days*24*60*60*1000); 
        document.cookie = name + "="+ escape(value) + ";expires=" + exp.toGMTString(); 
    },
getCookie:function(c_name){
if (document.cookie.length>0)
  {
  c_start=document.cookie.indexOf(c_name + "=");
  if (c_start!=-1)
    { 
    c_start=c_start + c_name.length+1 ;
    c_end=document.cookie.indexOf(";",c_start);
    if (c_end==-1) c_end=document.cookie.length;
    return unescape(document.cookie.substring(c_start,c_end));
    } 
  }
return "";
},
  bigload:function(num,s) {
    var str =s?s:'数据加载中';
    $('#loadingToast').find('p').html(str);
     if(num){
       if($('#loadingToast').css('display') != 'none'){return;} 
   }
   var t = num?$('#loadingToast').fadeIn(100):setTimeout(function(){$('#loadingToast').fadeOut(100)},1000); 

   setTimeout(function() {
     $('#loadingToast').fadeOut(100);
   },10000);
  },

 newWebupload:function(uploadName,pickId,uploadSuccess,uploadError){
 
  // console.log('newWebupload')
  uploadName = WebUploader.create({
      auto: true,
      // swf文件路径
      swf: './js/webupload/Uploader.swf',
      // 文件接收服务端。
    //  server: '/api.php/base/upload',  
      server:'/api/ver1/index/uploadImage',
      // 选择文件的按钮。可选。
      // 内部根据当前运行是创建，可能是input元素，也可能是flash.
      pick: ''+pickId+'',
      // mimeTypes:'image/*,text/plain,application/msword,application/octet-stream,application/vnd.ms-excel,application/x-shockwave-flash',
      accept: {
        title: 'Files',

        mimeTypes: 'image/*' //这个会导致只能打开手机相机，无法调用相册
      },
      // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
      resize: false,
      chunked: true, //是否要分片处理大文件上传
      chunkSize:0.5*1024*1024, //分片上传，每片2M，默认是5M
      fileNumLimit:500*1024*1024
  }); 

  // 当有文件被添加进队列的时候
     uploadName.on('fileQueued', function(file) {
         fac.bigload(1,'上传中…');
     }); 

  // 文件上传成功，给item添加成功class, 用样式标记上传成功。
  uploadName.on( 'uploadSuccess', function( file ,res) {    
      uploadSuccess(file,res);  
  });

  // 文件上传失败，显示上传出错。
  uploadName.on( 'uploadError', function( file,res ) {   
    uploadError(file,res);
  });

},

delCookie:function(name){ 
        //删除cookies 
        var exp = new Date(); 
        exp.setTime(exp.getTime() - 1); 
        var cval=getCookie(name); 
        if(cval!==null){document.cookie= name + "="+cval+";expires="+exp.toGMTString();} 
    },
numtotime:function(time){
    //数字转换成时间格式
    var retime = '';
    if(parseInt(time)>0){
            var date = new Date(time); 
                var year = date.getYear() + 1900;
                var month = date.getMonth()+1;
                month = month<10?'0'+month:month;
                var datev = date.getDate();
                datev = datev<10?'0'+datev:datev;
                return year + '-' + month + '-' + datev;
    }else{
    return retime;
   }    
  }, 
getDatezh:function(tm){ 
    /*将时间戳转成 全时间格式2015年3月15日 下午2:57:37*/
    var tt=new Date(parseInt(tm)).toLocaleString();
    return tt; 
    },
getDateen:function(tm){ 
    /*将时间戳转成 全时间格式转换成  2011-3-16 16:50:43 */   
     if(tm===0){return ''; }
    var tt=new Date(parseInt(tm)).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ");
    return tt; 
    }, 
  time:function(str){
        //返回时间戳；str 为空则返回当前时间戳；
   var timestamp = !str?Date.parse(new Date()):Date.parse(new Date(str)); 
   return timestamp; 
},
setstore:function(key,value){
value = typeof(value) ==='object'?JSON.stringify(value):value;
localStorage.setItem(key,value);
 return true;
},
getstore:function(key){
      var tem = '';
      try {tem = localStorage.getItem(key);
      tem = JSON.parse(tem); 
      }catch(e){tem = localStorage.getItem(key);}
      return tem; 
},
unsetstore:function(key){ localStorage.removeItem(key); return true;}, 
ysfetch:function(vueo,part){
    if(!vueo)return;
    if(!part)return; 
    var p = fac.seturl(part);
    fac[p.method](vueo,part); 
},
yssend:function(vueo,path,type){

     var p = fac.seturl(path); 
     if(!vueo[path].watch.time)return; 
       //运行前 ，执行的函数；
        if(typeof(vueo[path].before)==="function"){var v = vueo[path].before(vueo); if(v===false){return false;} } 
        var data = vueo[path].params||{};  
        fac[type](p.url,data,function(re){

             vueo[path].status = 1;
             vueo[path].data = re.code=='1'?re.data:{}; 
             if(typeof(vueo[path].done)==="function"){vueo[path].done(vueo,re);}
        }); 
},
yssendwatch:function(vueo,path,type){
        //路径 
  var p = fac.seturl(path);
  var time = path + '.watch.time';
  vueo.$watch(time,function(){
    if(!vueo[path].watch.time)return; 
   //运行前 ，执行的函数；
if(typeof(vueo[path].before)==="function"){var v = vueo[path].before(vueo); if(v===false){return false;} } 
var data = vueo[path].params||{};  
$('#test').html(JSON.stringify(data));
    fac[type](p.url,data,function(re){
      
         vueo[path].status = 1;
         vueo[path].data = re.code=='1'?re.data:{};
          // debugger;
         if(typeof(vueo[path].done)==="function"){vueo[path].done(vueo,re);}
    }); 
  },{deep: true});
}, 
  get_data:function(vueo,path){ 
fac.yssend(vueo,path,'get'); 
  },
    post_data:function(vueo,path){  
fac.yssend(vueo,path,'post');  
},
  get_data_watch:function(vueo,path){
  fac.yssendwatch(vueo,path,'get');
  },
  post_data_watch:function(vueo,path){ 
    fac.yssendwatch(vueo,path,'post');     
},
//验证手机号码是否正确，正确返回true  错误返回false；
testphone:function (num){    
    var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|145|147|159|153)+\d{8})$/;
  if(!myreg.test(num)){
    return false;
  }else{
    return true;
  }
},


msg:function (str,time) {
      time = time?time:2;
      layer.open({
        content: str,
        skin: 'msg',
        time: time 
      });
},
domatchart:function(data,title) { 
          var option = {
            "title": { 
            text:title,
            textStyle:{
                fontSize:'16'
            }
        },
    tooltip : {
        trigger: 'axis',
        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
        }
    },
    legend: {
        y:'25',
         x: 'right',
        data: ['已送', '未送', '漏送', '异常']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        top:'50',
        containLabel: true
    },
    xAxis:  {
        type: 'value'
    },
    yAxis: {
        type: 'category',
        data: data.name
    },
    series: [
        {
            name: '已送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
             itemStyle:{
                  normal:{color:'#00cc33'}
              },
            data: data.ys
        },
        {
            name: '未送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
             itemStyle:{
                  normal:{color:'#BBB'}
              },
            data: data.ws
        },
        {
            name: '漏送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: { 
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
            itemStyle:{
                  normal:{color:'#FF6666'}
              },
            data: data.ls
        } 
       
    ]
}; 
var myChart1 = echarts.init(document.getElementById('barone'),'vintage');//,"macarons"
myChart1.setOption(option);

myChart1.on('click', function (params) {
    // 控制台打印数据的名称
    console.log(params.name);
});
myChart1.on('legendselectchanged', function (params) {
  return false;
    // 获取点击图例的选中状态
    var isSelected = params.selected[params.name];
    // 在控制台中打印
    console.log((isSelected ? '选中了' : '取消选中了') + '图例' + params.name);
    // 打印所有图例的状态
    console.log(params.selected);
});


},
hntchart:function(data,title) { 

            var option2 = {
                 "title": { 
                    text: title,
                    textStyle:{
                        fontSize:'16'
                    }
                }, 
    tooltip : {
        trigger: 'axis',
        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
        }
    },
    legend: {
        y:'25',
        x: 'right',
        data: ['已送', '未送', '漏送', '异常']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis:  {
        type: 'value'
    },
    yAxis: {
        type: 'category',
        data: data.name
    },
    series: [
        {
            name: '已送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
             itemStyle:{
                  normal:{color:'#00cc33'}
              },
            data: data.ys
        },
        {
            name: '未送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
             itemStyle:{
                  normal:{color:'#bbbbbb'}
              },
            data:  data.ws
        },
        {
            name: '漏送',
            type: 'bar',
            stack: '总量',
            label: {
                normal: { 
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
            itemStyle:{
                  normal:{color:'#FF6666'}
              },
            data:  data.ls
        },
        {
            name: '异常',
            type: 'bar',
            stack: '总量',
            label: {
                normal: { 
                    show: true,
                    formatter:gl,
                    position: 'insideRight'
                }
            },
            itemStyle:{
                  normal:{color:'#F93'}
              },
            data:  data.yc
        }
       
    ]
};

 

var myChart2 = echarts.init(document.getElementById('bartwo'),'vintage');//,"macarons"
myChart2.setOption(option2); 

 
}


 };



$(function () {
    var timeout;
      $.toptip = function(text, duration, type) {
    if(!text) return;
    if(typeof duration === typeof "a") {
      type = duration;
      duration = undefined;
    }
    duration = duration || 2000;
    var className = type ? 'bg-' + type : 'bg-danger';
    var $t = $('.weui_toptips').remove();
    $t = $('<div class="weui_toptips"></div>').appendTo(document.body);
    $t.html(text);
    $t[0].className = 'weui_toptips ' + className

    clearTimeout(timeout);

    if(!$t.hasClass('weui_toptips_visible')) {
      $t.show().width();
      $t.addClass('weui_toptips_visible');
    }

    timeout = setTimeout(function() {
      $t.removeClass('weui_toptips_visible');
      $t.remove();
    }, duration);
  };


    var pageManager = {
        $container: $('#container'),
        _pageStack: [],
        _configs: [],
        _pageAppend: function(){},
        _defaultPage: null,
        _pageIndex: 1,
        setDefault: function (defaultPage) {
            this._defaultPage = this._find('name', defaultPage);
            return this;
        },
        setPageAppend: function (pageAppend) {
            this._pageAppend = pageAppend;
            return this;
        },
        init: function () {
            var self = this;

            $(window).on('hashchange', function () {
                var state = history.state || {};
                var url = location.hash.indexOf('#') === 0 ? location.hash : '#';
                var page = self._find('url', url) || self._defaultPage;
                if (state._pageIndex <= self._pageIndex || self._findInStack(url)) {
                    self._back(page);
                } else {
                    self._go(page);
                }
            });

            if (history.state && history.state._pageIndex) {
                this._pageIndex = history.state._pageIndex;
            }

            this._pageIndex--;

            var url = location.hash.indexOf('#') === 0 ? location.hash : '#';
            var page = self._find('url', url) || self._defaultPage;
            this._go(page);
            return this;
        },
        push: function (config) {
            this._configs.push(config);
            return this;
        },
        go: function (to) {
            var config = this._find('name', to);
            if (!config) {
                return;
            }
            location.hash = config.url;
        },
        _go: function (config) {
            this._pageIndex ++;

            history.replaceState && history.replaceState({_pageIndex: this._pageIndex}, '', location.href);

            var html = $(config.template).html();
            var $html = $(html).addClass('slideIn').addClass(config.name);
            $html.on('animationend webkitAnimationEnd', function(){
                $html.removeClass('slideIn').addClass('js_show');
            });
            this.$container.append($html);
            this._pageAppend.call(this, $html);
            this._pageStack.push({
                config: config,
                dom: $html
            });

main[config.name]?main[config.name]():'';

            if (!config.isBind) {
                this._bind(config);
            }

            return this;
        },
        back: function () {
            history.back();
        },
        _back: function (config) {
            this._pageIndex --;

            var stack = this._pageStack.pop();
            if (!stack) {
                return;
            }

            var url = location.hash.indexOf('#') === 0 ? location.hash : '#';
            var found = this._findInStack(url);
            if (!found) {
                var html = $(config.template).html();
                var $html = $(html).addClass('js_show').addClass(config.name);
                $html.insertBefore(stack.dom);

                if (!config.isBind) {
                    this._bind(config);
                }

                this._pageStack.push({
                    config: config,
                    dom: $html
                });
            }

            stack.dom.addClass('slideOut').on('animationend webkitAnimationEnd', function () {
                stack.dom.remove();
            });

            return this;
        },
        _findInStack: function (url) {
            var found = null;
            for(var i = 0, len = this._pageStack.length; i < len; i++){
                var stack = this._pageStack[i];
                if (stack.config.url === url) {
                    found = stack;
                    break;
                }
            }
            return found;
        },
        _find: function (key, value) {
            var page = null;
            for (var i = 0, len = this._configs.length; i < len; i++) {
                if (this._configs[i][key] === value) {
                    page = this._configs[i];
                    break;
                }
            }
            return page;
        },
        _bind: function (page) {
            var events = page.events || {};
            for (var t in events) {
                for (var type in events[t]) {
                    this.$container.on(type, t, events[t][type]);
                }
            }
            page.isBind = true;
        }
    };

    function fastClick(){
        var supportTouch = function(){
            try {
                document.createEvent("TouchEvent");
                return true;
            } catch (e) {
                return false;
            }
        }();
        var _old$On = $.fn.on;

        $.fn.on = function(){
            if(/click/.test(arguments[0]) && typeof arguments[1] == 'function' && supportTouch){ // 只扩展支持touch的当前元素的click事件
                var touchStartY, callback = arguments[1];
                _old$On.apply(this, ['touchstart', function(e){
                    touchStartY = e.changedTouches[0].clientY;
                }]);
                _old$On.apply(this, ['touchend', function(e){
                    if (Math.abs(e.changedTouches[0].clientY - touchStartY) > 10) return;

                    e.preventDefault();
                    callback.apply(this, [e]);
                }]);
            }else{
                _old$On.apply(this, arguments);
            }
            return this;
        };
    }
 
    function androidInputBugFix(){
        // .container 设置了 overflow 属性, 导致 Android 手机下输入框获取焦点时, 输入法挡住输入框的 bug
        // 相关 issue: https://github.com/weui/weui/issues/15
        // 解决方法:
        // 0. .container 去掉 overflow 属性, 但此 demo 下会引发别的问题
        // 1. 参考 http://stackoverflow.com/questions/23757345/android-does-not-correctly-scroll-on-input-focus-if-not-body-element
        //    Android 手机下, input 或 textarea 元素聚焦时, 主动滚一把
        if (/Android/gi.test(navigator.userAgent)) {
            window.addEventListener('resize', function () {
                if (document.activeElement.tagName == 'INPUT' || document.activeElement.tagName == 'TEXTAREA') {
                    window.setTimeout(function () {
                        document.activeElement.scrollIntoViewIfNeeded();
                    }, 0);
                }
            });
        }
    }


    function setPageManager(){
        var pages = {}, tpls = $('script[type="text/html"]');
        var winH = $(window).height();

        for (var i = 0, len = tpls.length; i < len; ++i) {
            var tpl = tpls[i], name = tpl.id.replace(/tpl_/, '');
            pages[name] = {
                name: name,
                url: '#' + name,
                template: '#' + tpl.id
            };
        }
        pages.home.url = '#';

        for (var page in pages) {
            pageManager.push(pages[page]);
        }
        pageManager
            .setPageAppend(function($html){
                var $foot = $html.find('.page__ft');
                if($foot.length < 1) return;

                if($foot.position().top + $foot.height() < winH){
                    $foot.addClass('j_bottom');
                }else{
                    $foot.removeClass('j_bottom');
                }
            })
            .setDefault('home')
            .init();
    }

    function init(){ 
        fastClick();
        androidInputBugFix(); 
        setPageManager();

        window.pageManager = pageManager;
        window.home = function(){
            location.hash = '';
        };



    }
    init();
});


    $(function(){
//定义常用的公共方法 
// $(window).on('touchstart', function(){ console.log('body trigger tap event'); alert(123)});
        var winH = $(window).height();
        var categorySpace = 10;

// fac.binditem();


        //工程，子单位下拉 显示隐藏
      //   $(window).on('click','#prostlkey',function(){
      //   var sh = $('.prostl').hasClass('open');
      //   $('.prostl').toggleClass('open'); 
      //   !sh?$('#iosMask').fadeIn(200):$('#iosMask').fadeOut(200);
      // });

      //  $(window).on('click','#sinstlkey',function(){
      //   var sh = $('.sinstl').hasClass('open');
      //   $('.sinstl').toggleClass('open'); 
      //   !sh?$('#iosMask').fadeIn(200):$('#iosMask').fadeOut(200);
      // }); 
      // $(window).on('click','#iosMask',function(){
      //    $('.prostl').removeClass('open');
      //    $('.sinstl').removeClass('open');
      //    $('#iosMask').fadeOut(200);
      // });


       


      
    });















window.YSPORT = {}; 
var OBJ = { 
    data:{ 
    sitedata:{},
    com_pro:{
        status:0,
        data:[],
        params:{},
        watch:{time:0}
    }
    },
};

window.mainvue = new Vue(OBJ); 
fac.ysfetch(mainvue,'com_pro'); 


window.main = {
	home:function(){

function homectrl(mv) {
window.homevm = new Vue({
      el:'#myprolist',
      data:{
        prodata:mv.com_pro.data.datalist 
      },
      methods:{
        nopro:function() {
      //fac.showlip('请先创建工程及子单位！');
        alert('请先创建工程及子单位!');
        },
        pronum:function(arr) {
          var t = 0;
          this.prodata.map(function(elm) {
            if(elm.isdel==0){
              t += 1;
            }
          });
          return t;
           
        },
         checkpro:function(n) {                 
                      //拿sitedata 和 更新里面的数据；
                       var sitedata = fac.getstore('sitedata');
                       this.prname = this.prodata[n].prname;
                       sitedata.prname = this.prname;
                       sitedata.proindex = n ;                 /////cbz///// 
                       sitedata.prcodeid = this.prodata[n].codeid;
                       if(this.prodata[n].sinchl.datalist.length>0){
                        sitedata.sname = this.prodata[n].sinchl.datalist[0].sname;
                        sitedata.scodeid = this.prodata[n].sinchl.datalist[0].codeid;
                       }else{
                        sitedata.sname = '';
                        sitedata.scodeid = ''; 
                       }
                       fac.setstore('sitedata',sitedata);  
                    }
        }
  });

    TouchSlide({ 
          slideCell:"#focus",
          titCell:".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
          mainCell:".bd ul", 
          effect:"leftLoop", 
          autoPlay:true,//自动播放
          autoPage:true //自动分页
        });
     fac.bigload(0);

     
 
}

  fac.bigload(1);
setTimeout(function() {

  // body...//先判断 有还是没有
fac.afterloaddo(mainvue,homectrl);  
},300)
	},


	user:function(){

           var userobj = { 
            el:"#userbody",
            data:{ 
              ut:['','超级管理员','普通管理员','河狸建筑会员'], 
            user_info:{
                status:0,
                data:[],
                params:{},
                watch:{time:0}, 
            },
            unbindwe:{
              status:0,
                data:[],
                params:{type:3},
                watch:{time:0},
            }
            },
            methods:{
              unbind:function() {

                uservm.unbindwe.watch.time = fac.time();
              }
            }
        };

        var uservm = new Vue(userobj);

        fac.ysfetch(uservm,'user_info'); 
        fac.ysfetch(uservm,'unbindwe'); 
        
        uservm.user_info.watch.time = fac.time();



		
	},
  myinfo:function(){

          var myobj = { 
            el:"#mybody",
            data:{  
            my_info:{
                status:0,
                data:{},
                params:{},
                watch:{time:0}, 
            },
            my_edit:{
              status:0,
                data:{},
                params:{},
                watch:{time:0},
            }
            },
            methods:{
              save:function() { 
                myvm.my_edit.before = function(vm) {
                  debugger;
                  if (!myvm.my_info.data.nicheng) {
                     $.toptip('请填写昵称！', 'warning'); return false;
                    
                  }
                  myvm.my_edit.params = myvm.my_info.data;
                };
                myvm.my_edit.done = function(vm,re) {
                    fac.dore(re,'user');
                };
          setTimeout(function(){
            myvm.my_edit.watch.time = fac.time();
            },500);
                
              }
            }
        };

        var myvm = new Vue(myobj);

        fac.ysfetch(myvm,'my_info'); 
        fac.ysfetch(myvm,'my_edit'); 
        
        myvm.my_info.watch.time = fac.time();

        
  },
  pwd:function(){
    
          var pwdobj = { 
            el:"#pwdbody",
            data:{ 
            tempwd:{'oldpasswd':'','newpasswd':'','newpasswdtwo':''},  
            pwd_edit:{
              status:0,
                data:{},
                params:{},
                watch:{time:0},
            }
            },
            methods:{
              save:function() { 
                 
                pwdvm.pwd_edit.before = function(vm) {
                   if ($.trim(vm.tempwd.oldpasswd)=='') {
                    $.toptip('旧密码不能少于六位!', 'warning'); 
                         return false;
                    }
                    if ($.trim(vm.tempwd.newpasswd).length<6) { 
                        $.toptip('新密码不能少于六位!', 'warning'); 
                        return false;
                    }

                    if ($.trim(vm.tempwd.newpasswd)!=$.trim(vm.tempwd.newpasswdtwo)) { 
                                  $.toptip('两次密码不一致!', 'warning'); 
                                  return false; 
                    }

                    vm.tempwd.oldpasswd=MD5(vm.tempwd.oldpasswd);
                    vm.tempwd.newpasswd=MD5(vm.tempwd.newpasswd);
                    vm.tempwd.newpasswdtwo=MD5(vm.tempwd.newpasswdtwo);

                    vm.pwd_edit.params = vm.tempwd;
                };
                pwdvm.pwd_edit.done = function(vm,re) { 
                 fac.dore(re,'user');
                };

                pwdvm.pwd_edit.watch.time = fac.time();
              }
            }
        }; 
        var pwdvm = new Vue(pwdobj); 
        fac.ysfetch(pwdvm,'pwd_edit');
  },
  tel:function(){
    
           var telobj = { 
            el:"#telbody",
            data:{ 
              itime:0,
            temtel:{'tel':'','phcode':''},  
            tel_edit:{
              status:0,
                data:{},
                params:{},
                watch:{time:0},
            },
            get_code:{
              status:0,
                data:{},
                params:{},
                watch:{time:0},
            }
            },
            methods:{
              sendcode:function() {
                _this = this;
                telvm.get_code.before = function(vm) { 
                  var a = fac.testphone(vm.temtel.tel);
                  if(!a){
                    $.toptip('手机号码格式错误!', 'warning'); 
                    return false;
                  }
                    vm.get_code.params = vm.temtel;
                };
                telvm.get_code.done = function(vm,re) { 
                 if(re.code==1){
                      _this.itime = 60 ;                               
                      var Intervaler = setInterval(function(){
                        _this.itime -= 1;
                        if (_this.itime==0) {
                         clearInterval(Intervaler); 
                        }
                       },1000)
                 }else{
                  $.toptip(re.msg, 'warning'); 
                 }
                };
                 telvm.get_code.watch.time = fac.time();
              },
              save:function() {                 
                telvm.tel_edit.before = function(vm) { 
                    vm.tel_edit.params = vm.temtel;
                };
                telvm.tel_edit.done = function(vm,re) { 
                 fac.dore(re,'user');
                };

                telvm.tel_edit.watch.time = fac.time();
              }
            }
        }; 
        var telvm = new Vue(telobj); 
        fac.ysfetch(telvm,'tel_edit');
         fac.ysfetch(telvm,'get_code');  

  },
  shangxian:function(){
    var myobj = { 
            el:"#tuijianbody",
            data:{  
            my_info:{
                status:0,
                data:{},
                params:{},
                watch:{time:0}, 
            }, 
            },
            
        };

        var myvm = new Vue(myobj);

        fac.ysfetch(myvm,'my_info');  
        
        myvm.my_info.watch.time = fac.time();
  },
  reg:function(){
    
  },
  bind:function(){
    
  },
  sin:function(){
           
        //从sitedata 获取 proindex 当前工程 
        var sitedata = fac.getstore('sitedata');
        var proindex = sitedata.proindex;
        var sinindex = sitedata.sinindex;    
             function sinctrl(mv) {
                window.sinlistvm = new Vue({
                  el:'#sinbody',
                  data:{
                    prosta:false,        
                    proindex:proindex,
                    sinindex:'',
                    prodata:mv.com_pro.data.datalist,
                    prname:fac.getprname(),
                    sname:'', 
                    showdel:0,
                    prcode:'',
                    scode:'',
                    pro_del:{
                      data:{},
                      params:{},
                      watch:{time:0}
                    },
                    sin_del:{
                      data:{},
                      params:{},
                      watch:{time:0}
                    }             
                  },       
                  methods:{
                    yschk:fac.yschk,
                    changeopen:fac.changeopen, 
                    selectitem:function(arr,k) {
                        arr.map(function(elm) {
                           elm.check = 0; 
                        });
                        arr[k].check = arr[k].check?0:1;
                        this.scode = arr[k].codeid;
                        this.sname = arr[k].sname ;
                        this.sinindex = k;
                        this.showdel = arr[k].check;
                    },




                    delpro:function(val) {
                      var sitedata = fac.getstore('sitedata');
       var _this = this; 
 $('#iosDialog1').fadeIn(200);
 $('#iosDialog1').find('#diatext').html('确定要删除'+sitedata.prname+'么？');
  $(".dialogsyes").unbind();
 $('.dialogsyes').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200); 
           
                sinlistvm.pro_del.before = function(vm) {
                   if(sitedata.prcodeid==''){
                     $.toptip('请选择工程', 'warning');
                    return false;}
                  vm.pro_del.params = {codeid:sitedata.prcodeid}; 
                }; 
              sinlistvm.pro_del.done = function(vm,re) { 
              if(re.code==1){

                  homevm.prodata[_this.proindex].isdel = 1; 
                 
                  $.toptip('删除成功', 'success');

                   window.pageManager.back('home');

              }else{
                  $.toptip(re.msg+',删除失败', 'error');
              }
          }
                sinlistvm.pro_del.watch.time = fac.time();
               
        });

$('.dialogsno').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);
          });
 
                    },





  delsin:function(arr){
     var sitedata = fac.getstore('sitedata');
       var _this = this; 
 $('#iosDialog1').fadeIn(200);
 $('#iosDialog1').find('#diatext').html('确定要删除'+this.sname+'么？');
 $(".dialogsyes").unbind();
 $('.dialogsyes').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200); 
           
                sinlistvm.sin_del.before = function(vm){
                  if(_this.scode==''){
                     $.toptip('请选择子单位', 'warning');
                    return false;}
                  vm.sin_del.params = {codeid:_this.scode}; 
                }; 
              sinlistvm.sin_del.done = function(vm,re) { 
              if(re.code==1){  
                _this.showdel = 0;
                  arr[_this.sinindex].isdel = 1; 
                  $.toptip('删除成功', 'success');
              }else{
                  $.toptip('删除失败', 'error');
              }
          }
                sinlistvm.sin_del.watch.time = fac.time();
               
        });

$('.dialogsno').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);
          });

                    },       
                    checkpro:function(n) {
                      this.proindex = n;
                      this.prosta = false;
                      fac.changeopen('#sinbody','all');  
                      //拿sitedata 和 更新里面的数据；
                      var sitedata = fac.getstore('sitedata');
                      this.prname = this.prodata[n].prname;
                      this.prcode = this.prodata[n].codeid;
                       sitedata.prname = this.prname;
                       sitedata.prcodeid = this.prodata[n].codeid;

                       if(this.prodata[n].sinchl.datalist.length>0){
                        sitedata.sname = this.prodata[n].sinchl.datalist[0].sname;
                        sitedata.scodeid = this.prodata[n].sinchl.datalist[0].codeid;
                       }else{
                        sitedata.sname = '';
                        sitedata.scodeid = ''; 
                       }
                       fac.setstore('sitedata',sitedata);  
                    },
                     checksin:function(n) {
                       this.sinindex = n;
                       this.prname = this.prodata[this.proindex].prname;
                       this.sname = this.prodata[this.proindex].sinchl.datalist[this.sinindex].sname;                       
                       var sitedata = fac.getstore('sitedata');
                       sitedata.prcodeid =  this.prodata[this.proindex].codeid;
                       sitedata.scodeid =  this.prodata[this.proindex].sinchl.datalist[this.sinindex].codeid;
                       sitedata.prname =  this.prname; 
                       sitedata.sname =this.sname; 

                       sitedata.proindex=this.proindex;
                       sitedata.sinindex=this.sinindex;

                       fac.setstore('sitedata',sitedata);                      
                    },
                     
                  }
              }); 

fac.ysfetch(sinlistvm,'pro_del');
fac.ysfetch(sinlistvm,'sin_del');

          }
          //先判断 有还是没有 
          fac.afterloaddo(mainvue,sinctrl);  
        
  },
  addsin:function(){
    
        //从sitedata 获取 proindex 当前工程 
                
                var sinvm = new Vue({
                  el:'#addsinbody',
                  data:{                  
                    prname:fac.getprname(),
                    sin_add:{
                      status:0,
                      data:{
                            codeid:'',
                            sname:'',
                            jiegou:1,
                            zhuti:'',
                            jichu:'',
                            sinimg:'',                      
                            cengshu:''
                          },
                      params:{},
                      watch:{time:0},
                      done:fac.done
                     } 
                  },       
                  methods:{
                    createbuwei:function() {
                      var cs = parseInt(this.sin_add.data.cengshu); 
                        if(!cs){ fac.showlip('层数不能为空');return false; }
                        if(cs>50){ fac.showlip('层数不能超过50层');return false; } 
                        
                       

                        this.sin_add.data.jichu = YSCONF.ext.jichu.join('\n');
 
                        var arr = [];
                         for (var i = 0; i < cs; i++) {
                               var lb = YSCONF.ext.zhuti[i]+'层梁板';
                               arr.push(lb);
                               var type = this.sin_add.data.jiegou =='1'?'柱':'墙柱';
                               var qz = YSCONF.ext.zhuti[i]+'层'+type;
                               arr.push(qz);
                           }  
                           arr.push('屋面梁板');
                         this.sin_add.data.zhuti = arr.join('\n'); 


                    },
                    sin_addsave:function() { 
                      
                       sinvm.sin_add.before=function(mv) { 
                       
                        
                        var sitedata = fac.getstore('sitedata');  

                         if(mv.sin_add.data.sname==''){ fac.showlip('请输入工程名称');return false; } 
                         if(mv.sin_add.data.cengshu==''){ fac.showlip('请输入层数');return false; } 
                         if(mv.sin_add.data.jichu==''){ fac.showlip('请输入基础部位');return false; } 
                         if(mv.sin_add.data.zhuti==''){ fac.showlip('请输入主体部位');return false; } 
                         fac.bigload(1);
                          mv.sin_add.params = mv.sin_add.data;
                          mv.sin_add.params.codeid = sitedata.prcodeid;
                       };
                       sinvm.sin_add.done = function(mv,re) {
                        fac.bigload(0);
                                  //请求工程列表
                                    mainvue.com_pro.done = function(vm,re) {
                                       sinlistvm.prodata = vm.com_pro.data.datalist;
                                       fac.setcode(vm);
                                    }
                                    mainvue.com_pro.watch.time = fac.time(); 

                                    fac.dore(re,'sin');
                       }
                       sinvm.sin_add.watch.time = fac.time();  
                    },                   
                    
                  }
              });   

              fac.ysfetch(sinvm,'sin_add'); 
setTimeout(function() {
              fac.newWebupload('headerupload','#localPicker3',function(file,res){
                  fac.bigload(0,'上传中…');
                  if (res.code==1) {
             sinvm.sin_add.data.sinimg=res.url;

                  }
              },function(file){
                console.log('error');
              });
},300);





  },
  editsin:function(){
    


             //从sitedata 获取 proindex 当前工程 
        var sitedata = fac.getstore('sitedata');
        var proindex = sitedata.proindex;
        var sinindex = sitedata.sinindex;  
        function editsinctrl(mv) { 
                var editsinvm = new Vue({
                  el:'#editsinbody',
                  data:{                  
                    prname:fac.getprname(),                   
                    editsindata:mv.com_pro.data.datalist[proindex].sinchl.datalist[sinindex],
                    com_em:{
                        status:0,
                        data:[],
                        params:{},
                        watch:{time:0},
                    },
                  },       
                  methods:{                  
                    comsave:function() { 
                       editsinvm.com_em.before=function(mv) { 

                         if (!mv.editsindata.sname){
                             fac.showlip('工程名称不能为空');return false;
                         };
                         if (!mv.editsindata.cengshu){
                             fac.showlip('工程层数不能为空');return false;
                         };

                         mv.com_em.params = mv.editsindata;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       editsinvm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       editsinvm.com_em.watch.time = fac.time();  
                    }                   
                    
                  }
              }); 

              fac.ysfetch(editsinvm,'com_em'); 

              setTimeout(function() {
              fac.newWebupload('headerupload','#localPicker4',function(file,res){
                  fac.bigload(0,'上传中…');
                  if (res.code==1) {
             editsinvm.editsindata.sinimg=res.url;

                  }
              },function(file){
                console.log('error');
              });
},300);
          }  
        fac.afterloaddo(mainvue,editsinctrl);

  },
  work:function(){
      
function workctrl(mv) {
var ind =  fac.getstore('sitedata');
var pi = ind.proindex;
var si = ind.sinindex;

// if(mv.com_pro.data.datalist.length>0 && mv.com_pro.data.datalist[pi].sinchl.datalist.length==0){
//     fac.showlip('请先回到首页，创建子单位');
// } 

    var workvm = new Vue({
      el:'#workpro',
      data:{
        prosta:false,
        sinsta:false,
        sinindex:si,
        proindex:pi,
        showtype:0,
        tap:0,
        ld:0, 
        prodata:mv.com_pro.data.datalist,
        prname:fac.getprname(),
        sname:fac.getsname(),
         work_image:{
                status:0,
                data:[],
                params:{},
                watch:{time:0}, 
            },
            work_matcount:{
                status:0,
                data:[],
                params:{},
                watch:{time:0}, 
            },


      },
      methods:{
        changeopen:fac.changeopen,
        checkpro:function(n) {
          this.proindex = n;
          this.prosta = false;
          this.sinsta = true;
          this.sname = '';
        },
        changetap:function(n) {
           this.tap = n;
           var v = this.showtype;
           var _this = this; 
          setTimeout(function() {
           if(n==1){ 
          var arr = [_this.work_image.data.quanbu,_this.work_image.data.jichu,_this.work_image.data.zhuti];
          var lit = ['','-基础','-主体'];
          var sitedata= fac.getstore('sitedata'); 
          var sname = sitedata['sname']; 
          var title = sname + lit[n] + '- 送检统计图'; 
          fac.hntchart(arr[v],title);  
            } 
          if(n==2){ fac.domatchart(_this.work_matcount.data,'工程原材送检统计图'); }//生成图表  
 },200); 

        },
        checksin:function(n) {
           this.showtype = 0;
           this.sinindex = n;
           this.prname = this.prodata[this.proindex].prname;
           this.sname = this.prodata[this.proindex].sinchl.datalist[this.sinindex].sname;
           
           var sitedata = fac.getstore('sitedata');
           sitedata.prcodeid =  this.prodata[this.proindex].codeid;
           sitedata.scodeid =  this.prodata[this.proindex].sinchl.datalist[this.sinindex].codeid;
           sitedata.prname =  this.prname; 
           sitedata.sname =this.sname ; 

           fac.setstore('sitedata',sitedata);
           this.sinsta = false;
           this.prosta = false;
           fac.changeopen('#workpro','all'); 


setTimeout(function() {
           workvm.work_image.watch.time = fac.time();
           workvm.work_matcount.watch.time = fac.time();
},200)
           

        },
        gettype:function(type,fid) {
            if(type==0){return true;}
            else{ 
              if(fid == type + 2){return true}else{return false;}
            } 
        },
        changeshowtype:function(n) {
           this.showtype = n;
           if(this.tap==1){
          var arr = [this.work_image.data.quanbu,this.work_image.data.jichu,this.work_image.data.zhuti];
          var lit = ['','-基础','-主体'];
          var sitedata= fac.getstore('sitedata'); 
          var sname = sitedata['sname']; 
          var title = sname + lit[n] + '- 送检统计图'; 
          fac.hntchart(arr[n],title);
           } 
          
        }
      }
  }); 


fac.ysfetch(workvm,'work_image');
fac.ysfetch(workvm,'work_matcount');

// 去拿原材统计数
workvm.work_matcount.before = function(mv) {
  fac.bigload(1);
  var sitedata = fac.getstore('sitedata');
   if(sitedata.prcodeid==''){fac.bigload(0);return false;}
  mv.work_matcount.params = {codeid:sitedata.prcodeid}
}

workvm.work_matcount.done = function(mv) {
   setTimeout(function() { fac.bigload(0); },500)
 
  
}
workvm.work_matcount.watch.time =fac.time();


//去拿 子单位形象进度数据 子单位图表数据；
workvm.work_image.before = function(mv){
  fac.bigload(1);
    var sitedata = fac.getstore('sitedata');
    if(sitedata.scodeid==''){fac.bigload(0);return false;}
    mv.work_image.params = {codeid:sitedata.scodeid}
  }
  workvm.work_image.done = function(mv){
    setTimeout(function() { fac.bigload(0); },1000)
    
  //   if(mv.ld==0){ 
  //   mv.ld=1; 
  // }else{
  //    fac.bigload(0);
  //    mv.ld=0; 
  // }
//生成图表 
  var sitedata= fac.getstore('sitedata'); 
  var sname = sitedata['sname']; 
  var arr = [mv.work_image.data.quanbu,mv.work_image.data.jichu,mv.work_image.data.zhuti];
  var lit = ['','-基础','-主体'];
  var title = sname + lit[0] + '- 送检统计图';  
  fac.hntchart(arr[0],title);

}

workvm.work_image.watch.time =fac.time();

   
}

fac.bigload(1);
setTimeout(function() {
  //先判断 有还是没有
fac.afterloaddo(mainvue,workctrl);
},300)

  },
  plan:function(){
    
function planctrl(mv) {
fac.setstore('pagetap','plan');
var sname = fac.getsname();
var sinmat = 0;



var ind =  fac.getstore('sitedata');
var pi = ind.proindex;
var si = ind.sinindex;

if(mv.com_pro.data.datalist.length>0 && mv.com_pro.data.datalist[pi].sinchl.datalist.length==0){
     fac.showlip('请先回到首页，创建子单位');
     sname = '原材';
     sinmat = 1; 

} 


    window.planvm = new Vue({
      el:'#plantop',
      data:{
        sitedata:fac.getstore('sitedata'),
        prosta:false,
        sinsta:false,
        sinindex:0,
        proindex:0,
        sinmat:sinmat,
        stype:'by',
        yctype:1,
        showdel:0,
        esta:0,
        sheet:false, 
        stp:{'by':'标养','ty':'同养','ks':'抗渗','zt':'柱头','dz':'焊接','qz':'砌筑','wq':'外墙','nq':'内墙','zp':'找平'},
        prodata:mv.com_pro.data.datalist,
        prname:fac.getprname(),
        sname:sname,
        plan_mat:{
                status:0,
                data:[],
                params:{},
                watch:{time:0},
                before:function(vm){  
                   fac.bigload(1);
                   var sitedata = fac.getstore('sitedata'); 
                   vm.plan_mat.params = {codeid:sitedata.prcodeid,yctype:vm.yctype};
              
                },
                done:function(v,re) {
                   
                  setTimeout(function() { fac.bigload(0);},600); }  
            },
        plan_songjian:{
                status:0,
                data:[],
                params:{},
                watch:{time:0},
                before:function(vm){ 
                  fac.bigload(1);
                   var sitedata = fac.getstore('sitedata');
                   vm.plan_songjian.params = {codeid:sitedata.scodeid,type:vm.stype};
                },
                done:function(vm,re) {
                  var arr = re.data.datalist; 
                  if(re.code>0){
                    re.data.datalist = arr.sort(function(a,b){
                    return a.myorder-b.myorder
                  });
                  }
                   
                  vm.plan_songjian.data =re.data;
                  setTimeout(function() { fac.bigload(0);},600);} 
            },
            com_ed:{
              status:0,
                data:[],
                params:{},
                watch:{time:0},
            },
            com_em:{
              status:0,
                data:[],
                params:{},
                watch:{time:0},
            },
            com_ea:{
              status:0,
                data:[],
                params:{},
                watch:{time:0},
            }
      },
      methods:{ 
         setcodeid:fac.setcodeid,
        yschk:fac.yschk,
        changeopen:fac.changeopen,
        setasta:function() {
           this.esta = this.esta?0:1;
        },
        lq:function(riqi,time,ys) { 
          //已送,就两个相减，未送就今天减去日期
          
         var timex = ys==1?fac.time(time):fac.time();
         var a = parseInt((timex - fac.time(riqi))/86400000); 
         a = a + '天';  
         return a;
        },
        selectitem:function(value,arr) { 

          value.check = value.check==0?1:0; 
          var a = 0;
          arr.map(function(elm) {
             var t = elm.check?elm.check:0;
             a += t;
          });
          this.showdel = a; 
        },
        selectall:function(arr) {
                  var x = 1;
                  if(arr.length==this.showdel){
                    x = 0;
                    this.showdel = 0;
                  }else{
                    this.showdel = arr.length;
                  }
                  arr.map(function(elm) {
                      elm.check = x;
                  });  
                },
                ornotchk:function(v) { 
                   var key = this.stype + 'ornot';
                   var sd = {};
                   sd[key] = v[key]==1?0:1;
                   sd.codeid = v.codeid;
                   planvm.com_em.before = function(vm) {
                  vm.com_em.params = sd; 
                }; 
                  planvm.com_em.done = function(vm,re) {  
                      if(re.code==1){ 
                      v[key] = sd[key];  
                          $.toptip('保存成功', 'success');
                      }else{
                          $.toptip('更新失败', 'error');
                      }
                  }
                planvm.com_em.watch.time = fac.time();

                },
        checksj:function(key){
          this.stype = key;
          this.showdel = 0;
          this.esta = 0;
          //触发获取数据 
          this.plan_songjian.watch.time = fac.time();
        },
        checkmat:function(key) {
          this.yctype = key;
          //触发获取数据 
          this.plan_mat.watch.time = fac.time();
        },
        checkpro:function(n) {
          this.proindex = n;
          this.prosta = false;
          this.sinsta = true;
          this.sname = '';
        },
        shwosheet:function() {
           this.sheet = !this.sheet;
           this.sheet?$('#iosMasktwo').fadeIn(200):$('#iosMasktwo').fadeOut(200);
        },
        comdel:function(arr) { 
        var _this = this; 
 $('#iosDialog1').fadeIn(200);
 $('#iosDialog1').find('#diatext').html('确定要删除选中项么？');
 $('.dialogsyes').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);
             
                var ar = [];
          arr.map(function(elm) {
            if(elm.check==1&&elm.isdel==0){
              ar.push(elm.codeid);
            }             
          }); 
             if(ar.length>0){
                planvm.com_ed.before = function(vm) {
                  vm.com_ed.params = {codeid:ar}; 
                }; 
              planvm.com_ed.done = function(vm,re) { 
                _this.showdel=0;
              if(re.code==1){ 
                      arr.map(function(elm) {
                        if(elm.check==1){elm.isdel=1;}             
                      });
                  $.toptip('保存成功', 'success');
              }else{
                  $.toptip('更新失败', 'error');
              }
          }
                planvm.com_ed.watch.time = fac.time();
              }
        });

$('.dialogsno').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);
          }); 
        },
        comadd:function(arr) {
          var typ = ['原材名称','钢筋','水泥','砂','砖','装饰','节能','防水','水电','安全'];
           var sd = {};
            var sitedata = fac.getstore('sitedata');
            

           if(this.sinmat==0){
            //混凝土
            sd.prcodeid = sitedata['prcodeid'];
            sd.codeid = this.plan_songjian.data.codeid; 
            sd.scodeid = sitedata['scodeid'];
            sd.bybuwei = '部位-新增';
            sd.byys = 0;
            sd.byornot = 1;
            sd.tyornot = 0;
            sd.ksornot = 0;
            sd.ztornot = 0;
            sd.cmornot = 0;
            sd.dzornot = 0;
            sd.qzornot = 0;
            sd.wqornot = 0;
            sd.nqornot = 0;
            sd.zpornot = 0; 
           }else{
            //原材
            sd.prcodeid = sitedata['prcodeid'];
            sd.codeid = this.plan_mat.data.codeid; 
            sd.yctype = this.yctype; 
            sd.mname = typ[this.yctype]+'-新增'; 
            sd.ycys = 0; 
           }
           sd.isdel = 0;
           sd.check = 0;


           this.com_ea.before = function(vm) {
              vm.com_ea.params = sd;
              $('#test').html(JSON.stringify(sd));
           };
           this.com_ea.done = function(vm,re) {
           
// $('#test2').html(JSON.stringify(re));
               if(re.code==1){ 
                sd.codeid = re.data.codeid;
                delete sd.prcodeid;
                delete sd.scodeid; 
                arr.unshift(sd);
                $.toptip('添加成功', 'success');
                }else{
                $.toptip('添加失败', 'error');

               }
           };
           //触发获取数据
            this.com_ea.watch.time = fac.time();
        },
        checksin:function(n) {
          this.showdel = 0;
          this.prname = this.prodata[this.proindex].prname;
          var sitedata = fac.getstore('sitedata');
          sitedata.prcodeid =  this.prodata[this.proindex].codeid;
          sitedata.prname =  this.prname; 

          if(n!='A'){
                 this.sinmat = 0;
                 this.sinindex = n; 
                 this.sname = this.prodata[this.proindex].sinchl.datalist[this.sinindex].sname;    
                 sitedata.scodeid =  this.prodata[this.proindex].sinchl.datalist[this.sinindex].codeid; 
                 sitedata.sname =this.sname ; 
                 //触发获取数据
                 this.plan_songjian.watch.time = fac.time();
          }else{
            this.sinmat = 1;
            this.sname = '原材';
            sitedata.scodeid = '';
            sitedata.sname =this.sname; 
            //触发获取数据
            this.plan_mat.watch.time = fac.time();


          }
         fac.setstore('sitedata',sitedata);
         this.sinsta = false;
         this.prosta = false;
         fac.changeopen('#plantop','all');  
           
        }
      }

  });

fac.ysfetch(planvm,'plan_songjian');
fac.ysfetch(planvm,'plan_mat');

fac.ysfetch(planvm,'com_ed');
fac.ysfetch(planvm,'com_ea');
fac.ysfetch(planvm,'com_em');
setTimeout(function() {
  // 触发获取数据
  if(sinmat==1){
    planvm.plan_mat.watch.time = fac.time();
  }else{
    planvm.plan_songjian.watch.time = fac.time();
  }
  
 
},300);



     
}


 fac.bigload(1);
//先判断 有还是没有
 fac.afterloaddo(mainvue,planctrl);
  },
  yc:function(){
    
         var ycobj = {
          el:'#ycbody',
          data:{
            yctypelist:YSCONF.ext.yctypelist,
            ftypelist:YSCONF.ext.ftypelist,
            yc_info:{
              status:0,
              data:{},
              params:{},
              watch:{time:0},
              done:fac.done,
              },
              com_em:{
              status:0,
              data:{},
              params:{},
              watch:{time:0}, 
              } 
          },
          methods:{
            dozushu:fac.dozushu,
            spl:fac.spl, 
            comsave:function() {  
              debugger;
                var ccph = [];
                $('input[name="ccph"]').each(function(index, el) { 
                  ccph.push(el.value);
                });
                var ypbh = [];
                $('input[name="ypbh"]').each(function(index, el) { 
                  ypbh.push(el.value);
                });                 
                 var jieguo = [];
                $('input[name="jieguo"]').each(function(index, el) { 
                  jieguo.push(el.value);
                });
                 
                 
               ycvm.com_em.before=function(mv) {                 
                mv.yc_info.data.ccph = ccph.join(',');
                mv.yc_info.data.jieguo = jieguo.join(',');
                mv.yc_info.data.ypbh = ypbh.join(',');

                 mv.com_em.params = mv.yc_info.data;
                 mv.com_em.params.lastupdate = fac.time()/1000;
               };
               ycvm.com_em.done = function(mv,re) {
                 var tap = fac.getstore('pagetap');
                if(tap=='plan'){
                   planvm.plan_mat.watch.time = fac.time();  
                } 
                  fac.dore(re,tap);
               }
               ycvm.com_em.watch.time = fac.time();  
            }
          } 
         };
         var ycvm = new Vue(ycobj);
         fac.ysfetch(ycvm,'yc_info');
         fac.ysfetch(ycvm,'com_em');
         
          ycvm.yc_info.before = function(mv) {
              fac.bigload(1); 
              mv.yc_info.params = {codeid:fac.getstore('wecodeid')};
  } 
         ycvm.yc_info.watch.time = fac.time();

  },
  sj:function(){
    
         var byobj = {
          el:'#bybody',
          data:{
            stype:fac.getstore('stype'),
             stp:{'by':'标养','ty':'同养','ks':'抗渗','zt':'柱头','dz':'焊接','qz':'砌筑','wq':'外墙','nq':'内墙','zp':'找平'},
             fenbudata:[     
                        {'title':'基础',t:'3'},{'title':'主体',t:'4'},{'title':'装修',t:'5'},
                        {'title':'幕墙',t:'6'},{'title':'屋面',t:'7'},{'title':'节能',t:'8'},
                        {'title':'给排水',t:'9'},{'title':'电气',t:'10'}],
            showcheck:0,
            fenbuarr:[],
            by_info:{
              status:0,
              data:{},
              params:{},
              watch:{time:0},
              done:fac.done
              },
              com_em:{
              status:0,
              data:{},
              params:{},
              watch:{time:0}, 
              } 
          },
          methods:{
            dozushu:fac.dozushu,
            spl:fac.spl, 
            yongchange:function(){
              var yl = this.by_info.data.byyl; 
              this.by_info.data.byzushu = yl>=1000?Math.ceil(yl/200):Math.ceil(yl/100); 
            },
           
        fenbumore: function(val, t, key) {
          var id = 'ad' + key;
          var chk = $("#" + id + "").is(':checked');

          if (chk) {
           byobj.data.by_info.data.fid.push(t);
          } else {
            byobj.data.by_info.data.fid = $.grep(byobj.data.by_info.data.fid, function(value) {
              return value != t;
            });

          };
        },

        ischk: function(t,all) {

          if (all) {
            var a = false;
            all.map(function(e) {
              if (e == t) {
                a = true;
              }
            });
            return a;
          }else{
            return false;
          };
        },

            riqichange:function(type) { 
              if(type=='by'||type=='ty'||type=='ks'||type=='zt'||type=='cm'){ 
                 var t = fac.time(this.by_info.data.byriqi); 
                var t1 = t + 28*86400000;
                var t2 = t + 30*86400000;
                var t3 = t + 7*86400000;
                this.by_info.data.bytime = fac.numtotime(t1);
                this.by_info.data.zttime = fac.numtotime(t1);
                this.by_info.data.kstime = fac.numtotime(t2);
                this.by_info.data.cmtime = fac.numtotime(t3);
              }
              if(type=='dz'){ 
                this.by_info.data.dztime = this.by_info.data.dzriqi;
              }
              if(type=='qz'||type=='wq'||type=='nq'||type=='zp'){
                var kx = type + 'riqi';
                var tx =  fac.time(this.by_info.data[kx]); 
                var t5 = tx + 28*86400000;
                var key = type + 'time';
                this.by_info.data[key] = fac.numtotime(t5);
              }
            },
            comsave:function() { 
              var _this = this;

              var bhkey = this.stype + 'bh';
                var bharr = [];
                $('input[name='+bhkey+']').each(function(index, el) { 
                  bharr.push(el.value);
                });

                var jgkey = this.stype + 'jg';
                var jgarr = [];
                $('input[name='+jgkey+']').each(function(index, el) { 
                 jgarr.push(el.value);
                });  


               byvm.com_em.before=function(mv) {  
                 mv.by_info.data[bhkey] = bharr.join(',');
                 mv.by_info.data[jgkey] = jgarr.join(',');
                 mv.by_info.data.fid = byobj.data.by_info.data.fid.join(',');
               
                


                 if(_this.stype=='by'||_this.stype=='ty'||_this.stype=='zt'){
                    var xpkey = _this.stype + 'xinpian';
                    var xparr = [];
                    $('input[name='+xpkey+']').each(function(index, el) { 
                     xparr.push(el.value);
                    }); 
                  mv.by_info.data[xpkey] = xparr.join(',');
                 }

                  if(_this.stype=='dz'){
                      // 牌号
                      var paihaoarr = [];
                      $('input[name="dzpaihao"]').each(function(index, el) { 
                       paihaoarr.push(el.value);
                      }); 
                      mv.by_info.data.dzpaihao = paihaoarr.join(',');
                      // 厂家
                       var dzchangjiaarr = [];
                      $('input[name="dzchangjia"]').each(function(index, el) { 
                       dzchangjiaarr.push(el.value);
                      }); 
                      mv.by_info.data.dzchangjia = dzchangjiaarr.join(',');
                      // 规格
                       var dzguigearr = [];
                      $('input[name="dzguige"]').each(function(index, el) { 
                       dzguigearr.push(el.value);
                      }); 
                      mv.by_info.data.dzguige = dzguigearr.join(',');
                  
                  
                 }
                 

                  mv.com_em.params = mv.by_info.data;
                 mv.com_em.params.lastupdate = fac.time()/1000;
               };

               byvm.com_em.done = function(mv,re) {
                 var tap = fac.getstore('pagetap');
                if(tap=='plan'){
                   planvm.plan_songjian.watch.time = fac.time();  
                }
                 
                 
                  fac.dore(re,tap);
               }

               byvm.com_em.watch.time = fac.time();  
            }
          } 
         };
         var byvm = new Vue(byobj);
         fac.ysfetch(byvm,'by_info');
         fac.ysfetch(byvm,'com_em');
         
          byvm.by_info.before = function(mv) {
              fac.bigload(1); 
              mv.by_info.params = {codeid:fac.getstore('wecodeid'),type:byvm.stype};
         };
         byvm.by_info.done = function(mv,re) {

         };
         byvm.by_info.watch.time = fac.time();

  },
  wendu:function(){
    
           var wenduobj = { 
            el:"#wendubody",                      
            data:{  
            wendu_info:{                       
                status:0,
                data:{tyinfo:{bybuwei:'',city:''},datalist:[]},
                params:{},
                watch:{time:0}, 
                done:fac.done,
                  } 
            },
            methods:{
              fanhui:function() {
                 window.pageManager.back('sj');
              }
            } 
        };
     var wenduvm = new Vue(wenduobj);
     fac.ysfetch(wenduvm,'wendu_info');  
    wenduvm.wendu_info.before = function(mv) {  
        fac.bigload(1); 
        mv.wendu_info.params = {codeid:fac.getstore('wecodeid'),type:'ty'};
      } 
    wenduvm.wendu_info.watch.time = fac.time();
       
  },
  base:function(){
    
 //从sitedata 获取 proindex 当前工程 
        var sitedata = fac.getstore('sitedata');
        var proindex = sitedata.proindex;
        var prname = sitedata.prname;


function basectrl(mv) {
    var vm = new Vue({
      el:'#base',
      data:{
        prosta:false,
        sinsta:false,
        proindex:proindex,
        prname:prname,
        prodata:mv.com_pro.data.datalist},
      methods:{
        changeopen:fac.changeopen,
        checkpro:function(n) {
          this.proindex = n;
          this.prosta = false;
          fac.changeopen('#base','all');  
          //拿sitedata 和 更新里面的数据；
          var sitedata = fac.getstore('sitedata');
          this.prname = this.prodata[n].prname;
           sitedata.prname = this.prname;
           sitedata.prcodeid = this.prodata[n].codeid;

           if(this.prodata[n].sinchl.datalist.length>0){
            sitedata.sname = this.prodata[n].sinchl.datalist[0].sname;
            sitedata.scodeid = this.prodata[n].sinchl.datalist[0].codeid;
           }else{
            sitedata.sname = '';
            sitedata.scodeid = ''; 
           }
           fac.setstore('sitedata',sitedata); 

          
        },
      }
  });
}
//先判断 有还是没有 
fac.afterloaddo(mainvue,basectrl); 
  },
  jiben:function(){
    
       var jiben_obj = { 
            el:"#jibenbody",                      
            data:{ 
            sitedata:{name:'123123'},
            com_province:{ 
                status:0,
                data:{},
                params:{},
                watch:{time:0}, 
            },
            com_city:{
                status:0,
                data:{},
                params:{},
                watch:{time:0},
                
            },
            jiben:{                       
                status:0,
                data:{pid:'11',cityid:'23'},
                params:{},
                watch:{time:0}, 
                  },
            com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
              
                       jibenvm.com_em.before=function(mv) { 

                    if (!jibenvm.jiben.data.prname){
                    fac.showlip('请填写工程名称');return false;
                    };

                    if (!jibenvm.jiben.data.cityid){
                    fac.showlip('请选择城市');return false;
                    };

                    if (!jibenvm.jiben.data.jiegou){
                    fac.showlip('请选择结构');return false;
                    };

                    if (jibenvm.jiben.data.kaigong>jibenvm.jiben.data.jungong){
                    fac.showlip('竣工日期必须大于开工日期！');return false;
                    };
                       


                         mv.com_em.params = jibenvm.jiben.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       jibenvm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       jibenvm.com_em.watch.time = fac.time();  
                    },
             selpro:function(e) { 
              var t = e.target.value;
              this.jiben.data.pid = t;
              jibenvm.com_city.before=function(vm) {
                   vm.com_city.params.pid = t;
                }; 
              if (jiben_obj.data.jiben.data.cityid) {
               jiben_obj.data.jiben.data.cityid='';
              };
                
              jibenvm.com_city.watch.time = fac.time();
            },
            selcity:function(e) {
              this.jiben.data.cityid = e.target.value;
            }
            } 
        };
     var jibenvm = new Vue(jiben_obj);
     fac.ysfetch(jibenvm,'jiben'); 
     fac.ysfetch(jibenvm,'com_em'); 
     fac.ysfetch(jibenvm,'com_province'); 
     fac.ysfetch(jibenvm,'com_city'); 
      jibenvm.jiben.before = function(mv) {
        var sitedata = fac.getstore('sitedata');
        mv.jiben.params = {codeid:sitedata.prcodeid}
      }
      jibenvm.jiben.done = function(vm,re) { 
               jibenvm.com_province.watch.time = fac.time();
               //获取城市
               jibenvm.com_city.before = function(vm) {
                  vm.com_city.params = {pid:re.data.pid}
               };
               jibenvm.com_city.watch.time = fac.time();
      }
    

    setTimeout(function() {

debugger;
              fac.newWebupload('headerupload','#localPicker2',function(file,res){
                  fac.bigload(0,'上传中…');
                  if (res.code==1) {
             jibenvm.jiben.data.proimg=res.url;

                  }
              },function(file){
                console.log('error');
              });

      jibenvm.jiben.watch.time = fac.time();
      
    },300);



  },
  jishu:function(){
    
           var jishu_obj = { 
            el:"#jishu_news",                      
            data:{ 
            sitedata:{name:'12'},
            jishu_info:{                       
                status:0,
                data:[{prname:'11'}],
                params:{codeid:4},
                watch:{time:0}, 
                  },
               com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       jishu_vm.com_em.before=function(mv) { 
                         mv.com_em.params = jishu_vm.jishu_info.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       jishu_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       jishu_vm.com_em.watch.time = fac.time();  
                    } 

            }
        };
     var jishu_vm = new Vue(jishu_obj);
     fac.ysfetch(jishu_vm,'jishu_info'); 
      fac.ysfetch(jishu_vm,'com_em');
    jishu_vm.jishu_info.before = function(mv) {

        var sitedata = fac.getstore('sitedata');

        mv.jishu_info.params = {codeid:sitedata.prcodeid}

      }

    jishu_vm.jishu_info.watch.time = fac.time();
  },
  shigong:function(){
    
          var sgong_obj = { 
          el:"#shi_gong",                      
          data:{ 
          sitedata:{name:'12'},
          shigong_unit:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
          com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       sgong_vm.com_em.before=function(mv) { 
                         mv.com_em.params = sgong_vm.shigong_unit.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       sgong_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       sgong_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var sgong_vm = new Vue(sgong_obj);
  fac.ysfetch(sgong_vm,'shigong_unit'); 
  fac.ysfetch(sgong_vm,'com_em');
  sgong_vm.shigong_unit.before = function(mv) {

      var sitedata = fac.getstore('sitedata');

      mv.shigong_unit.params = {codeid:sitedata.prcodeid}

    }

  sgong_vm.shigong_unit.watch.time = fac.time();
  },
  jianshe:function(){
    
        var jianshe_obj = { 
          el:"#jian_she",                      
          data:{ 
          sitedata:{name:'12'},
          jianshe_unit:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
               com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       jianshe_vm.com_em.before=function(mv) { 
                         mv.com_em.params = jianshe_vm.jianshe_unit.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       jianshe_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       jianshe_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var jianshe_vm = new Vue(jianshe_obj);
  fac.ysfetch(jianshe_vm,'jianshe_unit'); 
  fac.ysfetch(jianshe_vm,'com_em');
  jianshe_vm.jianshe_unit.before = function(mv) {

      var sitedata = fac.getstore('sitedata');

      mv.jianshe_unit.params = {codeid:sitedata.prcodeid}

    }

  jianshe_vm.jianshe_unit.watch.time = fac.time();
  },
  jianli:function(){
    
       var jianli_obj = { 
          el:"#jian_li",                      
          data:{ 
          sitedata:{name:'12'},
          jianli_unit:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
          com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       jianli_vm.com_em.before=function(mv) { 
                         mv.com_em.params = jianli_vm.jianli_unit.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       jianli_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       jianli_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var jianli_vm = new Vue(jianli_obj);
  fac.ysfetch(jianli_vm,'jianli_unit'); 
  fac.ysfetch(jianli_vm,'com_em'); 
  jianli_vm.jianli_unit.before = function(mv) {

      var sitedata = fac.getstore('sitedata');

      mv.jianli_unit.params = {codeid:sitedata.prcodeid}

    }

  jianli_vm.jianli_unit.watch.time = fac.time();
  },
  sheji:function(){
    
          var sheji_obj = { 
          el:"#she_ji",                      
          data:{ 
          sitedata:{name:'12'},
          sheji_unit:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
          com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       sheji_vm.com_em.before=function(mv) { 
                         mv.com_em.params = sheji_vm.sheji_unit.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       sheji_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       sheji_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var sheji_vm = new Vue(sheji_obj);
  fac.ysfetch(sheji_vm,'sheji_unit'); 
  fac.ysfetch(sheji_vm,'com_em');
  sheji_vm.sheji_unit.before = function(mv) {

      var sitedata = fac.getstore('sitedata');

      mv.sheji_unit.params = {codeid:sitedata.prcodeid}

    }

  sheji_vm.sheji_unit.watch.time = fac.time();
  },
  kancha:function(){
    
    var kancha_obj = { 
          el:"#kan_cha",                      
          data:{ 
          sitedata:{name:'12'},
          kancha:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
          com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       kanchai_vm.com_em.before=function(mv) { 
                         mv.com_em.params = kanchai_vm.kancha.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       kanchai_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       kanchai_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var kanchai_vm = new Vue(kancha_obj);
  fac.ysfetch(kanchai_vm,'kancha'); 
  fac.ysfetch(kanchai_vm,'com_em');
  kanchai_vm.kancha.before = function(mv) {

      var sitedata = fac.getstore('sitedata');

      mv.kancha.params = {codeid:sitedata.prcodeid}

    }

  kanchai_vm.kancha.watch.time = fac.time();
  },
  qita:function(){
    
             var other_obj = { 
          el:"#other_q",                      
          data:{ 
          sitedata:{name:'12'},
          othera_unit:{                       
              status:0,
              data:[{prname:'11'}],
              params:{codeid:4},
              watch:{time:0}, 
                },
          com_em:{
                  status:0,
                  data:[],
                  params:{},
                  watch:{time:0},
              }
            },
            methods:{             
               comsave:function() { 
                       other_vm.com_em.before=function(mv) { 
                         mv.com_em.params = other_vm.othera_unit.data;
                         mv.com_em.params.lastupdate = fac.time()/1000;
                       };
                       other_vm.com_em.done = function(mv,re) {
                          fac.dore(re,'gether');
                       }
                       other_vm.com_em.watch.time = fac.time();  
                    } 

          }
      };
  var other_vm = new Vue(other_obj);
  fac.ysfetch(other_vm,'othera_unit'); 
  fac.ysfetch(other_vm,'com_em');
  other_vm.othera_unit.before = function(mv) {
      var sitedata = fac.getstore('sitedata');
      mv.othera_unit.params = {codeid:sitedata.prcodeid}
    }

  other_vm.othera_unit.watch.time = fac.time();
  },
  gether:function(){
    
function getherctrl(mv) {
  fac.setstore('pagetap','gether');
    var getvm = new Vue({
      el:'#getherbody',
      data:{
        prosta:false,
        sinsta:false,
        sinindex:0,
        proindex:0,
        prodata:mv.com_pro.data.datalist,
        prname:fac.getprname(),
        sname:fac.getsname(),
        lsornot:true,
        btime:'',
        etime:'',
        gether_data:{
                status:0,
                data:{
                  by:{hzlist:[],lslist:[]},
                  ty:{hzlist:[],lslist:[]},
                  ks:{hzlist:[],lslist:[]},
                  zt:{hzlist:[],lslist:[]},
                  cm:{hzlist:[],lslist:[]},
                  dz:{hzlist:[],lslist:[]},
                  qz:{hzlist:[],lslist:[]},
                  wq:{hzlist:[],lslist:[]},
                  nq:{hzlist:[],lslist:[]},
                  zp:{hzlist:[],lslist:[]},
                  yc:{hzlist:[],lslist:[]}},
                params:{},
                watch:{time:0}, 
                done:fac.done,  
            },
        gether_save:{
                status:0,
                params:{},
                watch:{time:0}, 
                done:fac.done,
        }
      }, 
      created: function () { 
        this.btime = fac.numtotime(new Date().getTime());
        this.etime = fac.numtotime(new Date().getTime()+7*86400000);
         

  },
      methods:{
        yschk:fac.yschk,
        changeopen:fac.changeopen,
        find:function() {
          if (getvm.etime<getvm.btime) {
            $.toptip('结束日期必须大于起始日期', 'error');return false;
          };
          this.sinsta = false;
          fac.changeopen('#getherbody','all');
           fac.bigload(1);
          //触发拿数据
          setTimeout(function() {
             getvm.gether_data.watch.time = fac.time();
           },230); 
        },
        saveasjilu:function() {

       var _this = this; 
 $('#iosDialog1').fadeIn(200);
 $('#iosDialog1').find('#diatext').html('确定存为快照，以便在送检快照中查阅？（请通过电脑端查阅）');
  $(".dialogsyes").unbind();
 $('.dialogsyes').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);  
getvm.gether_save.done = function(mv,re) { 
            if(re.code==1){
               $.toptip('送检快照已经成功保存；', 'success');
            }else{
              $.toptip('保存失败！', 'error');
            }
          }
          getvm.gether_save.before = function(mv) {  
                   var sitedata = fac.getstore('sitedata');
                   mv.gether_save.params = {codeid:sitedata.prcodeid,btime:mv.btime,etime:mv.etime};
                }
          getvm.gether_save.watch.time = fac.time(); 
               
        });

$('.dialogsno').on('click', function(){
            $(this).parents('.js_dialog').fadeOut(200);
          });


















          
        },
        checkpro:function(n) {
          this.proindex = n;
          this.prosta = false;
          fac.changeopen('#getherbody','all');  
          //拿sitedata 和 更新里面的数据；
          var sitedata = fac.getstore('sitedata');
          this.prname = this.prodata[n].prname;
           sitedata.prname = this.prname;
           sitedata.prcodeid = this.prodata[n].codeid;

           if(this.prodata[n].sinchl.datalist.length>0){
            sitedata.sname = this.prodata[n].sinchl.datalist[0].sname;
            sitedata.scodeid = this.prodata[n].sinchl.datalist[0].codeid;
           }else{
            sitedata.sname = '';
            sitedata.scodeid = ''; 
           }
           fac.setstore('sitedata',sitedata); 
            fac.bigload(1);
          //触发拿数据
          setTimeout(function() {
               getvm.gether_data.watch.time = fac.time();
          },200)
        

        },
        setcodeid:fac.setcodeid,
      }
  });

fac.ysfetch(getvm,'gether_save');
fac.ysfetch(getvm,'gether_data');
getvm.gether_data.before = function(mv) {
    
                   fac.bigload(1);
                   var sitedata = fac.getstore('sitedata');
                   mv.gether_data.params = {codeid:sitedata.prcodeid,btime:mv.btime,etime:mv.etime};
                }
getvm.gether_data.watch.time = fac.time();

}

fac.bigload(1);
setTimeout(function() {
  //先判断 有还是没有 
fac.afterloaddo(mainvue,getherctrl); 
},200);
  },
  addpro:function(){
    
        var provm = new Vue({
          el:'#probody',
          data:{
            pro_add:{
                status:0,
                data:{'prname':'',pid:'',cityid:'',jiegou:'',kaigong:'',jungong:'',proimg:''},
                params:{},
                watch:{time:0}, 
            },
            com_province:{ 
                status:0,
                data:{},
                params:{},
                watch:{time:0}, 
            },
            com_city:{
                status:0,
                data:{},
                params:{},
                watch:{time:0} 
                
            }
          },
          methods:{
            selprovince:function(t) { 
              debugger;
              //如果遗留上一次的城市id 则先清楚
            if (provm.pro_add.data.cityid) {
              provm.pro_add.data.cityid='';
            }
              this.com_city.before=function(vm) { 
                   vm.com_city.params.pid = t;
                }; 
              this.com_city.watch.time = fac.time();
            },





            savepro:function() {
        
              provm.pro_add.before = function(vm) {
              debugger;
                vm.pro_add.params = provm.pro_add.data;
                if(vm.pro_add.params.prname==''){
                  $.toptip('工程名称不能为空!', 'warning'); 
                  return false;
                }
                if(vm.pro_add.params.pid==''){
                  $.toptip('请选择省份!', 'warning'); 
                  return false;
                }
                if(!vm.pro_add.params.cityid){
                  $.toptip('请选择城市!', 'warning'); 
                  return false;
                }
                if(vm.pro_add.params.jiegou==''){
                  $.toptip('请选择框架类型!', 'warning'); 
                  return false;
                }
                if(vm.pro_add.params.kaigong==''){
                  $.toptip('请选择开工日期!', 'warning'); 
                  return false;
                }
                if(vm.pro_add.params.jungong==''){
                  $.toptip('请选择竣工日期日期!', 'warning'); 
                  return false;
                }

                if(fac.time(vm.pro_add.params.jungong)<=fac.time(vm.pro_add.params.kaigong)){
                  $.toptip('竣工日期必须大于开工日期', 'warning'); 
                  return false;
                }
                fac.bigload(1);
              };
              provm.pro_add.done = function(vm,re) {
                 fac.bigload(0);
                  //请求工程列表
                  mainvue.com_pro.done = function(vm,re) {
                     
                     homevm.prodata = vm.com_pro.data.datalist;
                     fac.setcode(vm);
                  }
                  mainvue.com_pro.watch.time = fac.time();
                  fac.dore(re,'sin'); 
              };
              provm.pro_add.watch.time = fac.time();
            }
          }
        });

        fac.ysfetch(provm,'pro_add'); 
        fac.ysfetch(provm,'com_province'); 
        fac.ysfetch(provm,'com_city'); 

setTimeout(function() {
              fac.newWebupload('headerupload','#localPicker',function(file,res){
                  fac.bigload(0,'上传中…');
                  if (res.code==1) {
  debugger;
                //var data ={url:res.url,isdel:0};
             provm.pro_add.data.proimg=res.url;

                  }
              },function(file){
                console.log('error');
              });



   provm.com_province.watch.time = fac.time();
},300);
     
  },
  gether:function(){
    
  },
  gether:function(){
    
  },
  gether:function(){
    
  }
}